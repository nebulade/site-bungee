"use strict";if(!Bungee){var Bungee={}}Bungee._animationIndex=0;Bungee._debugAnimation=false;Bungee.Step=function(id,parent){var elem=new Bungee.Element(id,parent,"object");elem.addProperty("percentage",0);return elem};Bungee.Animation=function(id,parent){var elem=new Bungee.Element(id,parent,"object");var index=Bungee._animationIndex++;var dirty=true;var hasRules=false;var animationName="bungeeAnimation"+index;var keyFramesName="bungeeAnimationKeyFrames"+index;elem.addProperty("target",function(){return this.parent});elem.addProperty("duration",250);elem.addProperty("delay",0);elem.addProperty("loops",1);elem.addProperty("reverse",false);elem.addProperty("easing","ease");function animationStart(event){Bungee._debugAnimation&&console.log("start",event);elem.emit("started")}function animationIteration(event){Bungee._debugAnimation&&console.log("iteration",event)}function animationEnd(event){Bungee._debugAnimation&&console.log("end",event);elem.stop();elem.emit("finished")}function updateRules(){var rule1="";var rule2="";var rule3="";var rule4="";if(!Bungee._style){Bungee._style=document.createElement("style");document.getElementsByTagName("head")[0].appendChild(Bungee._style)}if(hasRules){var tmpName="."+animationName;var i;for(i=0;i<Bungee._style.sheet.cssRules.length;++i){if(Bungee._style.sheet.cssRules[i].name===keyFramesName){Bungee._style.sheet.deleteRule(i);break}}for(i=0;i<Bungee._style.sheet.cssRules.length;++i){if(Bungee._style.sheet.cssRules[i].selectorText===tmpName){Bungee._style.sheet.deleteRule(i);break}}}rule1+="."+animationName+" {\n";rule1+="   animation: ";rule1+=keyFramesName+" ";rule1+=elem.duration+"ms ";rule1+=elem.easing+" ";rule1+=elem.delay+" ";rule1+=elem.loops+" ";rule1+=(elem.reverse?"alternate":"normal")+";\n";rule1+="   -webkit-animation: ";rule1+=keyFramesName+" ";rule1+=elem.duration+"ms ";rule1+=elem.easing+" ";rule1+=elem.delay+" ";rule1+=elem.loops+" ";rule1+=(elem.reverse?"alternate":"normal")+";\n";rule1+="}\n";rule2+="@keyframes "+keyFramesName+" { \n";rule3+="@-webkit-keyframes "+keyFramesName+" { \n";for(var j in elem.children()){var child=elem.children()[j];if(typeof child.percentage==="undefined"){continue}rule2+="   "+child.percentage+"% {\n";rule3+="   "+child.percentage+"% {\n";for(var property in child._properties){if(child.hasOwnProperty(property)&&property!=="percentage"){rule2+="      "+property+": "+child[property]+";\n";rule3+="      "+property+": "+child[property]+";\n"}}rule2+="   }\n";rule3+="   }\n"}rule2+="}\n";rule3+="}\n";Bungee._debugAnimation&&console.log("Bungee Animation rules:\n",rule2,rule3,rule1);try{Bungee._style.sheet.insertRule(rule3,Bungee._style.sheet.rules.length)}catch(e){Bungee._debugAnimation&&console.error("Bungee Animation rule",rule3,"could not be inserted.",e)}try{Bungee._style.sheet.insertRule(rule2,Bungee._style.sheet.rules.length)}catch(e){Bungee._debugAnimation&&console.error("Bungee Animation rule",rule2,"could not be inserted.",e)}try{Bungee._style.sheet.insertRule(rule1,Bungee._style.sheet.rules.length)}catch(e){Bungee._debugAnimation&&console.error("Bungee Animation rule",rule1,"could not be inserted.",e)}hasRules=true}function addEventListeners(){elem._element=elem.target;if(elem._element&&elem._element.element){elem._element.element.addEventListener("webkitAnimationStart",animationStart,false);elem._element.element.addEventListener("webkitAnimationIteration",animationIteration,false);elem._element.element.addEventListener("webkitAnimationEnd",animationEnd,false)}}function markDirty(){dirty=true}elem.addChanged("target",addEventListeners);elem.addChanged("changed",markDirty);elem.start=function(){if(dirty){updateRules();dirty=false}if(elem._element)elem._element.className=animationName};elem.stop=function(){elem._element.className=""};elem.restart=function(){elem.stop();elem.start()};return elem};Bungee.Behavior=function(id,parent){var elem=new Bungee.Element(id,parent,"object");var index=Bungee._animationIndex++;var hasRules=false;var animationName="bungeeAnimation"+index;elem.addProperty("target",function(){return this.parent});function animationStart(event){Bungee._debugAnimation&&console.log("start",event);elem.emit("started")}function animationIteration(event){Bungee._debugAnimation&&console.log("iteration",event)}function animationEnd(event){Bungee._debugAnimation&&console.log("end",event);elem.stop();elem.emit("finished")}function updateRules(){var rule="";var rulepart="";var gotProperties=false;if(!Bungee._style){Bungee._style=document.createElement("style");document.getElementsByTagName("head")[0].appendChild(Bungee._style)}if(hasRules){var tmpName="."+animationName;var i;for(i=0;i<Bungee._style.sheet.cssRules.length;++i){if(Bungee._style.sheet.cssRules[i].selectorText===tmpName){Bungee._style.sheet.deleteRule(i);break}}}if(elem._properties.length===0){return}for(var property in elem._properties){if(elem.hasOwnProperty(property)&&property!=="target"){if(gotProperties){rulepart+=", "}else{gotProperties=true}rulepart+=property+" "+elem[property]}}rule+="."+animationName+" {\n";rule+="   -webkit-transition: "+rulepart+";\n";rule+="   transition: "+rulepart+";\n";rule+="}\n";if(gotProperties&&rule.indexOf("undefined")===-1){Bungee._debugAnimation&&console.log("Bungee Behavior rule",rule);try{Bungee._style.sheet.insertRule(rule,Bungee._style.sheet.rules.length)}catch(e){Bungee._debugAnimation&&console.error("Bungee Animation rule",rule,"could not be inserted.",e)}hasRules=true}}function addEventListeners(){elem._element=elem.target;if(elem._element&&elem._element.element){elem._element.element.addEventListener("webkitAnimationStart",animationStart,false);elem._element.element.addEventListener("webkitAnimationIteration",animationIteration,false);elem._element.element.addEventListener("webkitAnimationEnd",animationEnd,false);elem._element.className=animationName}}elem.addChanged("target",addEventListeners);elem.addChanged("changed",updateRules);return elem};"use strict";if(!Bungee){var Bungee={}}var compiler=function(){var compiler={};var ELEM_PREFIX="e";var ELEM_NS="Bungee.";var output;var index;var errorCodes={GENERIC:0,UNKNOWN_ELEMENT:1,NO_PROPERTY:2,NO_ELEMENTTYPE:3,NO_TYPENAME:4,NO_EXPRESSION:5,NO_COLON:6,INVALID_PROPERTY_NAME:7};compiler.errorCodes=errorCodes;var errorMessages=[];errorMessages[errorCodes.GENERIC]="generic error";errorMessages[errorCodes.UNKNOWN_ELEMENT]="Cannot create element.";errorMessages[errorCodes.NO_PROPERTY]="No property to assing expression.";errorMessages[errorCodes.NO_ELEMENTTYPE]="No type to create an element.";errorMessages[errorCodes.NO_TYPENAME]="No typename for the new type definition.";errorMessages[errorCodes.NO_COLON]="Property must be followed by a ':'.";errorMessages[errorCodes.NO_EXPRESSION]="No right-hand-side expression or element found.";errorMessages[errorCodes.INVALID_PROPERTY_NAME]="Invalid property name found.";function error(code,token){var ret={};ret.code=code;ret.context=token?token.CONTEXT:undefined;ret.message=errorMessages[code];ret.line=token?token.LINE:-1;return ret}function log(msg){if(Bungee.verbose){console.log(msg)}}function isNumeric(c){return c>="0"&&c<="9"}function addIndentation(additional){var indentLevel=index+(additional?additional:0);var i;for(i=indentLevel;i;--i){output+="    "}}function renderBegin(options){if(Bungee.debug){addIndentation(1);output+="debugger;\n"}output+="if (!window.Bungee) {\n";output+="    window.Bungee = {};\n";output+="}\n\n";if(options.module){output+="window.Bungee."+options.module+" = function () {\n"}else{output+="(function() {\n"}addIndentation();output+="'use strict';\n\n";addIndentation();output+="var "+ELEM_PREFIX+" = { \n";addIndentation(1);output+="children: [],\n";addIndentation(1);output+="addChild: function(child) {\n";addIndentation(2);output+="this[child.id] = child;\n";addIndentation(2);output+="for (var i in this.children) {\n";addIndentation(2);output+="    if (this.children.hasOwnProperty(i)) {\n";addIndentation(2);output+="        this.children[i][child.id] = child;\n";addIndentation(2);output+="        child[this.children[i].id] = this.children[i];\n";addIndentation(2);output+="    }\n";addIndentation(2);output+="}\n";addIndentation(2);output+=ELEM_PREFIX+".children.push(child);\n";addIndentation(2);output+="Bungee.Engine.addElement(child);\n";addIndentation(2);output+="return child;\n";addIndentation(1);output+="},\n";addIndentation(1);output+="initializeBindings: function() {\n";addIndentation(2);output+="for (var i = 0; i < "+ELEM_PREFIX+".children.length; ++i) { "+ELEM_PREFIX+".children[i].initializeBindings(); }\n";addIndentation(1);output+="},\n";addIndentation(1);output+="render: function() {\n";addIndentation(2);output+="for (var i = 0; i < "+ELEM_PREFIX+".children.length; ++i) { "+ELEM_PREFIX+".children[i].render(); }\n";addIndentation(1);output+="}\n";addIndentation();output+="};\n\n"}function renderEnd(options){addIndentation();output+=ELEM_PREFIX+".initializeBindings();\n";addIndentation();output+=ELEM_PREFIX+".render();\n";if(options.module){addIndentation();output+="return "+ELEM_PREFIX+";\n";output+="};\n"}else{output+="})();\n"}}function renderBeginElement(type,id){addIndentation();output+=ELEM_PREFIX+".addChild((function() {\n";++index;addIndentation();output+="var "+ELEM_PREFIX+" = new "+ELEM_NS+type+"(";output+=id?'"'+id+'"':"";output+=");\n"}function renderEndElement(){addIndentation();output+="return "+ELEM_PREFIX+";\n";--index;addIndentation();output+="})());\n"}function renderBeginType(type,inheritedType){addIndentation();output+=ELEM_NS+type+" = function (id, parent) {\n";++index;addIndentation();output+="var "+ELEM_PREFIX+" = new "+ELEM_NS+inheritedType+"(id, parent);\n"}function renderEndType(){addIndentation();output+="return "+ELEM_PREFIX+";\n";--index;addIndentation();output+="};\n"}function renderEventHandler(property,value){addIndentation();output+=ELEM_PREFIX+'.addEventHandler("'+property+'", ';output+="function () {\n";addIndentation();output+=value+"\n";addIndentation();output+="});\n"}function renderFunction(property,value){var name=property.slice(property.indexOf(" ")+1,property.indexOf("("));var args=property.slice(property.indexOf("(")+1,-1);addIndentation();output+=ELEM_PREFIX+'.addFunction("'+name+'", ';output+="function ("+args+") {\n";addIndentation();output+=value+"\n";addIndentation();output+="});\n"}function renderProperty(property,value){if(property==="id"){return}if(property.indexOf("on")===0){renderEventHandler(property,value);return}if(property.indexOf("(")!==-1){renderFunction(property,value);return}addIndentation();output+=ELEM_PREFIX+'.addProperty("'+property+'", ';output+="function () {";if(String(value).indexOf("return")!==-1){output+=value+" "}else{output+="return "+value+";"}output+="});\n"}function renderDelegate(property,value){addIndentation();output+=ELEM_PREFIX+".create"+property+" = function () {\n";addIndentation(1);output+="return new "+ELEM_NS+value+"();\n";addIndentation();output+="}\n"}function renderTreeObject(tree){var i;if(tree.typeDefinition){renderBeginType(tree.typeDefinition,tree.type)}else{renderBeginElement(tree.type,tree.id)}for(i=0;i<tree.properties.length;++i){renderProperty(tree.properties[i].name,tree.properties[i].value)}for(i=0;i<tree.delegates.length;++i){renderDelegate(tree.delegates[i].name,tree.delegates[i].value)}for(i=0;i<tree.types.length;++i){renderTreeObject(tree.types[i])}for(i=0;i<tree.elements.length;++i){renderTreeObject(tree.elements[i])}if(tree.typeDefinition){renderEndType()}else{renderEndElement()}}compiler.renderTree=function(tree,options,callback){var i;index=1;output="";renderBegin(options);for(i=0;i<tree.types.length;++i){renderTreeObject(tree.types[i])}for(i=0;i<tree.elements.length;++i){renderTreeObject(tree.elements[i])}renderEnd(options);callback(null,output)};function dumpObjectTree(tree,indent){var i;if(indent===undefined){indent=0}function niceLog(msg){var j;var out="";for(j=0;j<indent;++j){out+="  "}console.log(out+msg)}niceLog("+ Element:");niceLog("|- type: "+tree.type);niceLog("|- type definition: "+tree.typeDefinition);niceLog("|+ Properties:");for(i=0;i<tree.properties.length;++i){niceLog("|--> "+tree.properties[i].name)}niceLog("|+ Delegates:");for(i=0;i<tree.delegates.length;++i){niceLog("|--> "+tree.delegates[i].name+" : "+tree.delegates[i].value)}if(tree.types.length){niceLog("|+ Types:");for(i=0;i<tree.types.length;++i){dumpObjectTree(tree.types[i],indent+2)}}if(tree.elements.length){niceLog("|+ Elements: ");for(i=0;i<tree.elements.length;++i){dumpObjectTree(tree.elements[i],indent+2)}}}compiler.createObjectTree=function(tok,options,callback){var property;var tokens=tok;var token_length=tokens.length;var elementType;var elementTypeDefinition;var i,j;var TreeObject=function(parent){this.id=undefined;this.type=undefined;this.typeDefinition=undefined;this.parent=parent;this.types=[];this.elements=[];this.properties=[];this.delegates=[]};var objectTreeRoot=new TreeObject;objectTreeRoot.type="RootObject";var objectTree=objectTreeRoot;for(i=0;i<token_length;i+=1){var token=tokens[i];if(token.TOKEN==="IS_A"){if(elementType){elementTypeDefinition=elementType;elementType=undefined}else{callback(error(errorCodes.NO_TYPENAME,token),null);return}}if(token.TOKEN==="ELEMENT"){elementType=token.DATA}if(token.TOKEN==="SCOPE_START"){log("start element description");if(elementType){var tmp=new TreeObject(objectTree);tmp.type=elementType;if(elementTypeDefinition){tmp.typeDefinition=elementTypeDefinition;objectTree.types.push(tmp)}else{objectTree.elements.push(tmp)}objectTree=tmp;elementType=undefined;elementTypeDefinition=undefined}else{callback(error(errorCodes.NO_ELEMENTTYPE,token),null)}}if(token.TOKEN==="SCOPE_END"){log("end element description");objectTree=objectTree.parent}if(token.TOKEN==="EXPRESSION"){var next_token=i+1<token_length?tokens[i+1]:undefined;if(next_token&&next_token.TOKEN==="COLON"){property=token.DATA;log("property found '"+property+"'");if(isNumeric(property[0])){log("property name '"+property+"' is invalid.");callback(error(errorCodes.INVALID_PROPERTY_NAME,token),null);return}i+=1;next_token=undefined}else{callback(error(errorCodes.NO_COLON,token),null);return}next_token=i+1<token_length?tokens[i+1]:undefined;if(next_token&&next_token.TOKEN==="EXPRESSION"){log("right-hand-side expression found for property '"+property+"' '"+next_token.DATA+"'");if(property==="id"){objectTree.id=next_token.DATA}else{objectTree.properties.push({name:property,value:next_token.DATA})}i+=1;property=undefined}else if(next_token&&next_token.TOKEN==="ELEMENT"){log("right-hand-side element found for property",property,next_token.DATA);objectTree.delegates.push({name:property,value:next_token.DATA});i+=1;property=undefined}else{callback(error(errorCodes.NO_EXPRESSION,next_token),null);return}}}callback(null,objectTreeRoot)};compiler.compileAndRender=function(tok,options,callback){compiler.createObjectTree(tok,options,function(error,result){if(error){callback(error,null);return}if(options.dump){dumpObjectTree(result)}compiler.renderTree(result,options,callback)})};return compiler}();if(typeof window==="undefined"){module.exports=compiler}else{window.Bungee.Compiler=compiler}"use strict";if(!Bungee){var Bungee={}}Bungee.Item=function(id,parent,typeHint){var elem=new Bungee.Element(id,parent,typeHint?typeHint:"item");elem.addProperty("className","");elem.addProperty("width",100);elem.addProperty("height",100);elem.addProperty("top",0);elem.addProperty("left",0);elem.addProperty("childrenWidth",function(){var left=0;var right=0;var kids=this.children();for(var i in kids){if(kids.hasOwnProperty(i)){var c=kids[i];if(c.left<left){left=c.left}if(c.left+c.width>right){right=c.left+c.width}}}return right-left});elem.addProperty("childrenHeight",function(){var top=0;var bottom=0;var kids=this.children();for(var i in kids){if(kids.hasOwnProperty(i)){var c=kids[i];if(c.top<top){top=c.top}if(c.top+c.height>bottom){bottom=c.top+c.height}}}return bottom-top});return elem};Bungee.InputItem=function(id,parent){var elem=new Bungee.Item(id,parent,"InputItem");elem.addProperty("width",function(){return this.parent?this.parent.width:100});elem.addProperty("height",function(){return this.parent?this.parent.height:100});elem.addProperty("mouseAbsX",0);elem.addProperty("mouseAbsY",0);elem.addProperty("mouseRelX",0);elem.addProperty("mouseRelY",0);elem.addProperty("mouseRelStartX",0);elem.addProperty("mouseRelStartY",0);elem.addProperty("mousePressed",false);elem.addProperty("containsMouse",false);elem.addProperty("scrollTop",0);elem.addProperty("scrollLeft",0);elem.addProperty("srollWidth",0);elem.addProperty("scrollHeight",0);return elem};var tmpTextElement;Bungee.Text=function(id,parent){var elem=new Bungee.Item(id,parent);elem.addProperty("mouseEnabled",false);elem.addProperty("textWidth",0);elem.addProperty("textHeight",0);elem.addProperty("fontSize","");elem.addProperty("fontFamily","");elem.addProperty("text","");elem.addProperty("-text",function(){return this.text});elem.addProperty("width",function(){return this.textWidth});elem.addProperty("height",function(){return this.textHeight});if(!tmpTextElement){tmpTextElement=window.document.createElement("div");tmpTextElement.style.position="absolute";tmpTextElement.style.visibility="hidden";tmpTextElement.style.width="auto";tmpTextElement.style.height="auto";tmpTextElement.style.left=-1e4;document.body.appendChild(tmpTextElement)}function relayout(){var tmpProperty=elem.text;var width=0;var height=0;tmpTextElement.style.fontSize=elem.fontSize;tmpTextElement.style.fontFamily=elem.fontFamily;if(tmpTextElement.innerHTML===tmpProperty){width=tmpTextElement.clientWidth+1;height=tmpTextElement.clientHeight+1}else if(tmpProperty!==""){tmpTextElement.innerHTML=tmpProperty;width=tmpTextElement.clientWidth+1;height=tmpTextElement.clientHeight+1}elem.textWidth=width;elem.textHeight=height}elem.addChanged("text",relayout);return elem};Bungee.Window=function(id,parent){var elem=new Bungee.Element(id,parent);elem.addProperty("innerWidth",window.innerWidth);elem.addProperty("innerHeight",window.innerHeight);elem.addProperty("width",function(){return this.innerWidth});elem.addProperty("height",function(){return this.innerHeight});elem.addEventHandler("load",function(){var that=this;window.addEventListener("resize",function(event){that.innerWidth=event.srcElement.innerWidth;that.innerHeight=event.srcElement.innerHeight})});return elem};Bungee.Rectangle=function(id,parent){var elem=new Bungee.Item(id,parent);elem.addProperty("backgroundColor","white");elem.addProperty("borderColor","black");elem.addProperty("borderStyle","solid");elem.addProperty("borderWidth",1);elem.addProperty("borderRadius",0);return elem};Bungee.BackgroundImage=function(id,parent){var elem=new Bungee.Item(id,parent);elem.addProperty("src","");elem.addProperty("backgroundImage",function(){if(!this.src){return""}if(this.src.indexOf("url('")===0){return this.src}return"url('"+this.src+"')"});elem.addProperty("backgroundPosition","center");elem.addProperty("backgroundRepeat","no-repeat");return elem};Bungee.Image=function(id,parent){var elem=new Bungee.Item(id,parent,"image");elem.addProperty("src","");elem.addProperty("-image-src",function(){return this.src});return elem};Bungee.Input=function(id,parent){var elem=new Bungee.Item(id,parent,"input");elem.addProperty("-webkit-user-select","auto");elem.addProperty("userSelect","auto");elem.addProperty("text",function(){return this.element.value});elem.addProperty("placeholder","");return elem};Bungee.RendererDOM=function(){this.currentMouseElement=undefined};Bungee.RendererDOM.prototype.createElement=function(typeHint,object){var elem;var that=this;if(typeHint==="input"){elem=document.createElement("input")}else if(typeHint==="image"){elem=document.createElement("img")}else{elem=document.createElement("div")}elem.style.position="absolute";if(object.id){elem.id=object.id}function handleTouchStartEvents(event){that.currentMouseElement=this;if(that.currentScrollElement){that.currentScrollElementTopStart=that.currentScrollElement.scrollTop;that.currentScrollElementLeftStart=that.currentScrollElement.scrollLeft}object.mousePressed=true;object.emit("mousedown")}function handleTouchEndEvents(event){object.mousePressed=false;object.mouseRelStartX=0;object.mouseRelStartY=0;object.emit("mouseup");if(that.currentMouseElement===this){object.emit("activated")}that.currentMouseElement=undefined}function handleTouchMoveEvents(event){object.mouseAbsX=event.clientX||event.targetTouches[0].clientX;object.mouseAbsY=event.clientY||event.targetTouches[0].clientY;object.mouseRelX=event.layerX||event.targetTouches[0].layerX;object.mouseRelY=event.layerY||event.targetTouches[0].layerY;object.emit("mousemove")}function handleMouseDownEvents(event){if(!event.used){that.currentMouseElement=this;event.used=true}object.mousePressed=true;object.mouseRelStartX=event.layerX;object.mouseRelStartY=event.layerY;object.emit("mousedown")}function handleMouseUpEvents(event){object.mousePressed=false;object.mouseRelStartX=0;object.mouseRelStartY=0;object.emit("mouseup");if(that.currentMouseElement===this){object.emit("activated")}that.currentMouseElement=undefined}function handleMouseMoveEvents(event){object.mouseAbsX=event.clientX;object.mouseAbsY=event.clientY;object.mouseRelX=event.layerX;object.mouseRelY=event.layerY;object.emit("mousemove")}function handleMouseOverEvents(event){object.containsMouse=true;object.emit("mouseover")}function handleMouseOutEvents(event){object.containsMouse=false;object.emit("mouseout")}function handleScrollEvents(event){if(that.currentScrollElement!==object){that.currentScrollElement=object;that.currentScrollElementTopStart=event.target.scrollTop;that.currentScrollElementLeftStart=event.target.scrollLeft}if(Math.abs(that.currentScrollElementTopStart-event.target.scrollTop)>20||Math.abs(that.currentScrollElementLeftStart-event.target.scrollLeft)>20){that.currentMouseElement=undefined}object.scrollTop=event.target.scrollTop;object.scrollLeft=event.target.scrollLeft;object.srollWidth=event.target.scrollWidth;object.scrollHeight=event.target.scrollHeight}elem.addEventListener("scroll",handleScrollEvents,false);if(typeHint==="InputItem"){if("ontouchstart"in document.documentElement){if(window.navigator.msPointerEnabled){elem.addEventListener("MSPointerDown",handleTouchStartEvents,false);elem.addEventListener("MSPointerMove",handleTouchMoveEvents,false);elem.addEventListener("MSPointerUp",handleTouchEndEvents,false)}else{elem.addEventListener("touchstart",handleTouchStartEvents,false);elem.addEventListener("touchmove",handleTouchMoveEvents,false);elem.addEventListener("touchend",handleTouchEndEvents,false)}}else{elem.addEventListener("mousedown",handleMouseDownEvents,false);elem.addEventListener("mouseup",handleMouseUpEvents,false);elem.addEventListener("mousemove",handleMouseMoveEvents,false);elem.addEventListener("mouseover",handleMouseOverEvents,false);elem.addEventListener("mouseout",handleMouseOutEvents,false)}}return elem};Bungee.RendererDOM.prototype.addElement=function(element,parent){if(!element.element){return}if(parent&&parent.element){parent.element.appendChild(element.element)}else{document.body.appendChild(element.element)}};Bungee.RendererDOM.prototype.removeElement=function(element,parent){if(!element.element){return}if(parent&&parent.element){parent.element.removeChild(element.element)}else{document.body.removeChild(element.element)}};Bungee.RendererDOM.prototype.addElements=function(elements,parent){var fragment=document.createDocumentFragment();for(var i=0;i<elements.length;++i){if(!elements[i].element){continue}fragment.appendChild(elements[i].element)}if(parent&&parent.element){parent.element.appendChild(fragment)}else{document.body.appendChild(fragment)}};Bungee.RendererDOM.prototype.renderElement=function(element){var name;if(!element.element){return}for(name in element._dirtyProperties){if(name==="className"&&element[name]!==""){element.element.className=element[name]}else if(name==="scale"){var s=element.scale.toFixed(10);var tmp="scale("+s+", "+s+")";element.element.style["-webkit-transform"]=tmp;element.element.style["transform"]=tmp}else if(name==="-text"){element.element.innerHTML=element[name]}else if(name==="-image-src"){element.element.src=element[name]}else if(name==="placeholder"){element.element.placeholder=element[name]}else{element.element.style[name]=element[name]}}element._dirtyProperties={}};"use strict";if(!Bungee){var Bungee={}}if(!Bungee.Engine){Bungee.Engine=function(){var ret={};var getterCalled={};var _dirtyElements={};ret.verbose=false;ret._elementIndex=0;function log(msg,error){if(ret.verbose||error){console.log("[Bungee.Engine] "+msg)}}function maybeReportGetterCalled(silent,name){if(!silent){Bungee.Engine.addCalledGetter(this,name)}}try{var renderer=new Bungee.RendererDOM;ret.createElement=renderer.createElement;ret.addElement=renderer.addElement;ret.addElements=renderer.addElements;ret.renderElement=renderer.renderElement;ret.removeElement=renderer.removeElement}catch(e){log("Cannot create DOM renderer",true);ret.createElement=function(){};ret.addElements=function(){};ret.addElement=function(){};ret.renderElement=function(){};ret.removeElement=function(){}}ret.enterMagicBindingState=function(){log("enterMagicBindingState");getterCalled={};ret.maybeReportGetterCalled=maybeReportGetterCalled};ret.exitMagicBindingState=function(){log("exitMagicBindingState\n\n");ret.maybeReportGetterCalled=function(){};return getterCalled};ret.maybeReportGetterCalled=function(){};ret.addCalledGetter=function(element,property){getterCalled[element.id+"."+property]={element:element,property:property}};var renderInterval;var fps={};fps.d=Date.now();fps.l=0;function advance(){var keys=Object.keys(_dirtyElements);var keys_length=keys.length;for(var i=0;i<keys_length;++i){_dirtyElements[keys[i]].render()}_dirtyElements={};if(Bungee.verbose){if(Date.now()-fps.d>=2e3){console.log("FPS: "+fps.l/2);fps.d=Date.now();fps.l=0}else{++fps.l}}}ret.start=function(){renderInterval=window.setInterval(advance,1e3/60);advance()};ret.stop=function(){window.clearInterval(renderInterval)};ret.dirty=function(element,property){if(property[0]==="_"){return}element._dirtyProperties[property]=true;if(!_dirtyElements[element._internalIndex]){_dirtyElements[element._internalIndex]=element}};return ret}()}Bungee.Element=function(id,parent,typeHint){this.id=id;this.typeHint=typeHint;this.parent=parent;if(typeHint!=="object"){this.element=Bungee.Engine.createElement(typeHint,this)}else{this.element=null}this._internalIndex=Bungee.Engine._elementIndex++;this._dirtyProperties={};this._properties={};this._connections={};this._children={};this._bound={};this._isInitialized=false;this._initializeBindingsStep=false;if(this.parent){this.parent.addChild(this)}};Bungee.Element.prototype.children=function(){Bungee.Engine.maybeReportGetterCalled.call(this,false,"children");return this._children};Bungee.Element.prototype.removeChild=function(child){Bungee.Engine.removeElement(child,this);delete this._children[child._internalIndex];this.emit("children")};Bungee.Element.prototype.removeChildren=function(){var i;for(i in this._children){if(this._children.hasOwnProperty(i)){Bungee.Engine.removeElement(this._children[i],this)}}this._children={};this.emit("children")};Bungee.Element.prototype.addChild=function(child){if(child.id)this[child.id]=child;if(this.id)child[this.id]=this;for(var i in this._children){if(this._children.hasOwnProperty(i)){if(child.id)this._children[i][child.id]=child;if(this._children[i].id)child[this._children[i].id]=this._children[i]}}this._children[child._internalIndex]=child;child.parent=this;Bungee.Engine.addElement(child,this);this.emit("children");return child};Bungee.Element.prototype.render=function(){Bungee.Engine.renderElement(this)};Bungee.Element.prototype.addChanged=function(signal,callback){if(!this._connections[signal]){this._connections[signal]=[]}this._connections[signal].push(callback)};Bungee.Element.prototype.removeChanged=function(obj,signal){var signalConnections=this._connections[signal];if(!signalConnections){return}};Bungee.Element.prototype.addBinding=function(name,value,property){var that=this;var hasBinding=false;var val,getters;var bindingFunction;Bungee.Engine.enterMagicBindingState();if(typeof value==="function"){val=value.apply(this);bindingFunction=function(){that[name]=value.apply(that)}}else if(typeof value==="object"&&typeof property!=="undefined"){val=value[property];bindingFunction=function(){that[name]=value[property]}}else{val=value}getters=Bungee.Engine.exitMagicBindingState();this.breakBindings(name);for(var getter in getters){if(getters.hasOwnProperty(getter)){var tmp=getters[getter];this._bound[name][this._bound[name].length]={element:tmp.element,property:tmp.property};tmp.element.addChanged(tmp.property,bindingFunction);hasBinding=true}}return{hasBindings:hasBinding,value:val}};Bungee.Element.prototype.addEventHandler=function(event,handler){var that=this;var signal=event;if(signal===""||typeof handler!=="function"){return}if(signal.indexOf("on")===0){signal=signal.slice(2)}this.addChanged(signal,function(){if(!that._initializeBindingsStep)handler.apply(that)})};Bungee.Element.prototype.breakBindings=function(name){if(this._bound[name]){for(var i=0;i<this._bound[name].length;++i){this._bound[name][i].element.removeChanged(this,name)}}this._bound[name]=[]};Bungee.Element.prototype.setSilent=function(name,value){var setter=this.__lookupSetter__(name);if(typeof setter==="function"){setter.call(this,value,true)}};Bungee.Element.prototype.getSilent=function(name){var getter=this.__lookupGetter__(name);if(typeof getter==="function"){return getter.call(this,true)}};Bungee.Element.prototype.set=function(name,value){this.breakBindings(name);if(typeof value==="function"){var ret=this.addBinding(name,value);if(ret.hasBindings){this[name]=value}else{this[name]=ret.value}}else{this[name]=value}};Bungee.Element.prototype.addFunction=function(name,value){this[name]=value};var defPropCount=0;var notdefPropCount=0;Bungee.Element.prototype.addProperty=function(name,value){var that=this;var valueStore;this._properties[name]=value;if(!this.hasOwnProperty(name)){Object.defineProperty(this,name,{get:function(silent){Bungee.Engine.maybeReportGetterCalled.call(that,silent,name);if(typeof valueStore==="function")return valueStore.apply(that);return valueStore},set:function(val,silent){if(valueStore===val)return;valueStore=val;if(!silent){that.emit(name);that.emit("changed")}Bungee.Engine.dirty(that,name)}})}};Bungee.Element.prototype.initializeBindings=function(options){var name,i;if(this._isInitialized){return}this._isInitialized=true;this._initializeBindingsStep=true;for(name in this._properties){if(this._properties.hasOwnProperty(name)){var value=this._properties[name];if(typeof value==="function"){var ret=this.addBinding(name,value);if(ret.hasBindings){this[name]=value}else{this[name]=ret.value}}else{this[name]=value}}}if(!options||!options.deferRender){this.render()}for(i in this._children){if(this._children.hasOwnProperty(i)){this._children[i].initializeBindings(options)}}this._initializeBindingsStep=false;this.emit("load")};Bungee.Element.prototype.emit=function(signal){if(signal in this._connections){var slots=this._connections[signal];for(var i=0;i<slots.length;++i){slots[i].apply()}}};Bungee.Collection=function(id,parent){var elem=new Bungee.Element(id,parent,"object");return elem};"use strict";if(!Bungee){var Bungee={}}Bungee.debug=false;Bungee.verbose=false;Bungee.jump=function(){Bungee.useQueryFlags();Bungee.compileScriptTags();Bungee.Engine.start()};Bungee.useQueryFlags=function(){Bungee.verbose=window.location.href.indexOf("verbose")>=0;Bungee.debug=window.location.href.indexOf("debug")>=0};Bungee.compileScriptTagElement=function(script){var tokens=Bungee.Tokenizer.parse(script.text);var moduleName=script.attributes.module&&script.attributes.module.textContent;Bungee.Compiler.compileAndRender(tokens,{module:moduleName},function(error,result){if(error){console.error("Bungee compile error: "+error.line+": "+error.message);
console.error(" -- "+error.context)}else{try{if(Bungee.verbose||Bungee.debug){console.log("----------------------");console.log(result);console.log("----------------------");console.log("eval...");var o=new Date;eval(result);var n=new Date;console.log("done, eval took time: ",n-o,"ms")}else{eval(result)}}catch(e){console.error("Bungee error in generated JavaScript: ",e)}}})};Bungee.compileScriptTags=function(scriptType){var type=scriptType?scriptType:"text/jml";for(var i=0;i<window.document.scripts.length;++i){var script=window.document.scripts[i];if(script.type===type){Bungee.compileScriptTagElement(script)}}};"use strict";if(!Bungee){var Bungee={}}var tokenizer=function(){var c,i,line,tokens,bindings,exp,colonOnLine,comment,lineContext;var ret={};function log(msg){if(Bungee.verbose){console.log(msg)}}function addToken(type,data){tokens.push({TOKEN:type,DATA:data,LINE:line,CONTEXT:lineContext})}function parseElementName(){var token="";while(c){if(c==="\n"){i-=1;break}if(c>="A"&&c<="Z"||c>="a"&&c<="z"||c>="0"&&c<="9"||c==="_"||c==="-")token+=c;else break;advance()}return token}function parseExpression(){var expression="";while(c){if(c==="\n"){i-=1;break}if(!colonOnLine&&c===":"){i-=1;break}expression+=c;advance()}return expression}function parseInlineBlock(){var block="";advance();while(c){if(c==="}"&&exp[i+1]==="^"){advance();break}if(c==="\n"){++line}block+=c;advance()}return block}function advance(){c=exp[++i];return c}ret.parse=function(input){exp=input;i=-1;line=1;lineContext="";tokens=[];c=undefined;bindings=[];colonOnLine=false;comment=false;while(advance()){if(comment&&c!=="\n")continue;if(c==="/"&&exp[i+1]==="/"){comment=true;continue}if(c==="\n"){comment=false;colonOnLine=false;++line;lineContext="";var j=i;var tmpChar=exp[++j];while(tmpChar){if(tmpChar==="\n"){break}lineContext+=tmpChar;tmpChar=exp[++j]}continue}if(c>="A"&&c<="Z"){addToken("ELEMENT",parseElementName());continue}if(c>="a"&&c<="z"||c>="0"&&c<="9"||c==='"'||c==="'"||c==="("||c==="-"||c==="_"||c==="["){addToken("EXPRESSION",parseExpression());continue}if(c==="{"){addToken("SCOPE_START");continue}if(c==="}"){addToken("SCOPE_END");continue}if(c==="^"&&exp[i+1]==="{"){advance();addToken("EXPRESSION",parseInlineBlock());continue}if(c===":"){colonOnLine=true;addToken("COLON");continue}if(c==="@"){addToken("IS_A");continue}if(c===";"){colonOnLine=false;addToken("SEMICOLON");continue}}if(Bungee.verbose){ret.dumpTokens()}return tokens};ret.dumpTokens=function(){for(var i=0;i<tokens.length;++i)console.log("TOKEN: "+tokens[i].TOKEN+" "+(tokens[i].DATA?tokens[i].DATA:""))};return ret}();if(typeof window==="undefined"){module.exports=tokenizer}else{window.Bungee.Tokenizer=tokenizer}